{
    "name": "Node-identity-build",
    "group": "Node-identity",
    "enable_pipeline_locking": true,
    "environment_variables": [
        {
            "name": "JUNIT_REPORT_PATH",
            "value": "test_report.xml"
        }
    ],
    "materials": [
        {
            "url": "git@github.com:vytautas-mackonis/node-identity.git",
            "type": "git",
            "name": "node-identity"
        }
    ],
    "stages": [
        {
            "name": "build",
            "jobs": [
                {
                    "name": "build",
                    "tasks": [
                        {
                            "type": "exec",
                            "command": "npm",
                            "arguments": [ "install" ]
                        },
                        {
                            "type": "exec",
                            "run_if": "passed",
                            "command": "gulp",
                            "arguments": [ "test" ]
                        },
                        {
                            "type": "exec",
                            "run_if": "passed",
                            "command": "npm",
                            "arguments": [ "prune", "--production" ]
                        }
                    ],
                    "artifacts": [
                        {
                            "source": "dist/app",
                            "destination": "app",
                            "type": "build"
                        },
                        {
                            "source": "node_modules",
                            "destination": "node_modules",
                            "type": "build"
                        },
                        {
                            "source": "test_report.xml",
                            "destination": "test_reports",
                            "type": "test"
                        }
                    ]
                }
            ]
        }
    ]
}
